# 面向对象 III

## 类的多态

**多态**

在面向对象方法中一般是这样表述多态性的: 向不同的对象发送同一个消息，不同的对象在接收时会
产生不同的行为。每个对象可以用自己的方式去响应共同的消息，所谓消息，就是调用函数，不同的
行为就是指不同的实现。

**虚函数**

虚函数的作用是允许在派生类中重新定义与基类同名的函数，并且可以通过基类指针或引用来访问基类和
派生类中的同名函数

虚函数实现了同一类族中不同类的对象可以对同一函数调用作出不同的响应的动态多态性

### 虚函数的使用方法

- 在基类用 virtual 关键字声明成员函数为虚函数
  这样就可以在派生类中重新定义此函数，为它赋予新的功能，并能方便地调用它。在类外定义虚函数时
  不必再加`virtual`关键字

- 在派生类中重新定义此函数，要求函数名、函数类型、函数参数个数和类型全部与基类的虚函数相同，
  并根据派生类的需要重新定义函数体
  C++规定，当一个成员函数被声明为虚函数后，其派生类中的同名函数都自动成为虚函数。因此在
  派生类重新声明此函数时，可以加`virtual`关键字，也可以不加，但一般习惯在每一层声明该
  函数时都加 virtual 关键字，使程序更加清晰。如果在派生类中没有对基类的虚函数重新定义，
  则派生类简单地继承其直接基类的虚函数

- 定义一个指向基类对象的指针变量，并使它指向同一类族中需要调用该函数的对象。通过该指针变量
  调用此虚函数，此时调用的就是指针变量指向的对象的同名函数

- 通过虚函数与指向基类对象的指针变量的配合使用，就能方便地调用同一类族中不同类的同名函数，只要
  先用基类指针指向即可。如果指针不断地指向同一类族中不同类的对象，就能不断地调用这些对象中的同名
  函数

**需要说明以下几点**

- 有时在基类中定义的非虚函数会在派生类中被重新定义，如果用基类指针调用该成员函数，则系统会调用对象中基类部分
  的成员函数

- 如果用派生类指针调用该成员函数，则系统会调用派生类对象中的成员函数，这并不是多态行为

**根据什么考虑是否把一个成员函数声明为虚函数**

- 首先看成员函数所在的类是否会作为基类，然后看成员函数在类的继承后有无可能被更改功能，如果
  希望更改其功能，一般应该将它声明为虚函数

- 如果成员函数在类被继承后的功能不需要被修改，或派生类用不到该函数，则不要把它声明为虚函数

- 应考虑对成员函数的调用时通过对象名还是通过基类指针或引用去访问，如果时通过基类指针或应用去访问，
  应当声明为虚函数

- 有时，在定义虚函数时并不定义其函数体，即函数体是空的，它的作用只是定义了一个虚函数名，具体功能留给
  派生类去添加

## 纯虚函数

纯虚函数是在基类中声明的虚函数，它在基类中没有定义，但要求任何派生类都要定义自己的实现方法。
在基类中实现纯虚函数的方法是在函数原型后加`=0`

```
virtual void function() = 0;
```

在 C++中，构造函数不能声明为虚函数，这是因为编译器在构造对象时，必须知道确切类型，才能正确地生成
对象。在构造函数执行之情，对象并不存在，无法使用指向此对象的指针来调用构造函数。

然而，析构函数可以声明为虚函数，C++明确指出，当 derived class 对象经由一个 base class 指针被删除，
该 base class 带着一个非虚析构函数，会导致对象的 derived 成分没被销毁

> 虚函数是多态的基础
> 在 C++中没有虚函数就无法实现多态特性，因为不声明为虚函数就不能实现`动态联编`
> 就不能实现多态

## 面向对象总结

本章从对象的封装、继承、多态这三大特征来带领读者学习面向对象

**封装**

找到变化并且把它封装起来，就可以在不影响其他部分的前提下修改或扩展被封装的变化部分，封装解决了
程序的可扩展性，封装还有一个非常重要的功能就是**解**耦合

**继承**

子类继承父类，可以继承父类的方法和属性，实现了多态已经代码的重用，解决了系统的重用性和扩展性，
但是继承破坏了封装，因为其是对子类开放的，修改父类会导致所有子类的改变，因此继承一定程度上又破坏了
系统的可扩展性，所以继承需要慎用。

继承是在程序开发过程中重构得到的，而不是程序设计之初就使用继承，很多面向对象开发者滥用继承，结果可能
造成后期的代码变得不易维护，因此优先使用组合，而不是继承是面向对象开发中一个重要的经验

**多态**

接口的多种不同的实现方式即为多态。接口是对行为的抽象，上面在封装中提到，找到变化部分封装起来，但是封装起来后，
怎么适应与外界的变化，这正是接口的作用，接口的主要目的是为不相关的类提供通用的处理服务，从而实现系统的
可维护性、可扩展性

面向对象实现了人们所追求对于开发系统，**解耦合**、**可维护性**、**可扩展性**和**可重用性**
